<!DOCTYPE html>
<html>
<head>
    <title>IoT Temperature Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .temp-display {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            color: #667eea;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #764ba2;
        }
        button.locked {
            background: #999;
            cursor: not-allowed;
        }
        button.locked:hover {
            background: #999;
        }
        .info-box {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #ffeeba;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .auth-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px;
            background: #f8d7da;
            color: #721c24;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
        }
        .auth-status.authenticated {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        .lock-icon {
            color: #999;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="auth-status" id="authStatus">
        üîí Not Authenticated | <a href="/login">Login</a>
    </div>
    
    <div class="container">
        <h1>üå°Ô∏è Smart Home Temperature Monitor</h1>
        
        <!-- VULNERABILITY: Version disclosure -->
        <p style="text-align: right; color: #999; font-size: 12px;">Version 2.0.0 | Device: DEVICE_001</p>
        
        <div class="temp-display" id="temperature">--¬∞C</div>
        <div style="text-align: center; color: #666;" id="timestamp">Loading...</div>
        
        <div style="text-align: center; margin: 20px;">
            <button onclick="updateTemperature()">Refresh Temperature</button>
            <button onclick="showSettings()" id="settingsBtn" class="locked" title="Login required">
                üîí View Settings
            </button>
            <button onclick="showLogs()">System Logs</button>
        </div>
        
        <div class="warning" id="authWarning" style="display: none;">
            ‚ö†Ô∏è <strong>Authentication Required!</strong><br>
            Some features require login. Try default credentials or SQL injection at <a href="/login">/login</a>
        </div>
        
        <div class="info-box">
            <h3>Quick Command Execute üîí</h3>
            <div id="commandAuth" style="color: #999;">
                <em>Login required to execute commands</em>
            </div>
            <div id="commandInterface" style="display: none;">
                <input type="text" id="command" placeholder="Enter system command" style="width: 60%;">
                <button onclick="executeCommand()">Execute</button>
                <div id="commandOutput" style="margin-top: 10px;"></div>
            </div>
        </div>
        
        <div class="info-box" id="settings" style="display: none;">
            <h3>Device Settings üîì</h3>
            <div id="settingsContent">Loading...</div>
        </div>
        
        <div class="info-box">
            <h3>API Endpoints</h3>
            <p><strong>Public (No Auth):</strong></p>
            <ul>
                <li>‚úÖ <a href="/api/temperature">/api/temperature</a> - Current temperature</li>
                <li>‚úÖ <a href="/logs">/logs</a> - System logs</li>
                <li>‚úÖ <a href="/api/status">/api/status</a> - Auth status</li>
            </ul>
            <p><strong>Protected (Login Required):</strong></p>
            <ul>
                <li>üîí <a href="/api/settings" onclick="checkAuth(event)">/api/settings</a> - WiFi & Credentials</li>
                <li>üîí /api/command - Execute commands</li>
            </ul>
        </div>
        
        <!-- VULNERABILITY: Sensitive info in HTML comments -->
        <!-- TODO: Remove before production
        Default credentials: admin/123456
        SQL Injection: admin' --
        Token generation: MD5(username)
        -->
        
        <div style="margin-top: 20px; text-align: center;">
            <a href="/login">Admin Login</a> | 
            <a href="/api/status">Check Auth Status</a> |
            <a href="/logs">View Logs</a>
        </div>
    </div>
    
    <script>
        // Check authentication status on load
        function checkAuthStatus() {
            const token = getCookie('auth_token');
            const authStatus = document.getElementById('authStatus');
            const settingsBtn = document.getElementById('settingsBtn');
            const commandAuth = document.getElementById('commandAuth');
            const commandInterface = document.getElementById('commandInterface');
            
            if (token && token.length === 32) {
                authStatus.innerHTML = 'üîì Authenticated | <a href="#" onclick="logout()">Logout</a>';
                authStatus.className = 'auth-status authenticated';
                settingsBtn.className = '';
                settingsBtn.innerHTML = 'üîì View Settings';
                commandAuth.style.display = 'none';
                commandInterface.style.display = 'block';
                
                // Log to console (vulnerability)
                console.log('Authenticated with token:', token);
            } else {
                console.log('Not authenticated. Try logging in first!');
            }
        }
        
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
        
        function updateTemperature() {
            fetch('/api/temperature')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('temperature').innerText = data.temperature + '¬∞C';
                    document.getElementById('timestamp').innerText = 'Last updated: ' + data.timestamp;
                    console.log('Temperature data (public):', data);
                });
        }
        
        function showSettings() {
            const token = getCookie('auth_token');
            
            if (!token) {
                document.getElementById('authWarning').style.display = 'block';
                alert('Authentication required! Please login first.');
                window.location.href = '/login';
                return;
            }
            
            fetch('/api/settings')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error + '\n' + (data.hint || ''));
                        window.location.href = '/login';
                    } else {
                        // Display sensitive information
                        document.getElementById('settingsContent').innerHTML = `
                            <p><strong>üéâ ${data.message || ''}</strong></p>
                            <p><strong>API Key:</strong> ${data.api_key}</p>
                            <p><strong>Device ID:</strong> ${data.device_id}</p>
                            <p><strong>WiFi SSID:</strong> ${data.wifi_ssid}</p>
                            <p><strong>WiFi Password:</strong> ${data.wifi_password}</p>
                            <p><strong>MQTT Broker:</strong> ${data.mqtt_broker}:${data.mqtt_port}</p>
                            <p><strong>SSH Password:</strong> ${data.ssh_password || 'hidden'}</p>
                            <p><strong>Root Password:</strong> ${data.root_password || 'hidden'}</p>
                        `;
                        document.getElementById('settings').style.display = 'block';
                        
                        // Log to console (vulnerability)
                        console.log('Settings retrieved (authenticated):', data);
                    }
                });
        }
        
        function executeCommand() {
            const cmd = document.getElementById('command').value;
            const token = getCookie('auth_token');
            
            if (!token) {
                alert('Authentication required for command execution!');
                return;
            }
            
            fetch('/api/command', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({command: cmd})
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    if (data.error.includes('Authentication')) {
                        alert('Session expired. Please login again.');
                        window.location.href = '/login';
                    } else {
                        document.getElementById('commandOutput').innerHTML = 
                            '<pre style="color: red;">Error: ' + data.error + '</pre>';
                    }
                } else {
                    document.getElementById('commandOutput').innerHTML = 
                        '<pre>' + data.output + '</pre>';
                }
            });
        }
        
        function checkAuth(event) {
            const token = getCookie('auth_token');
            if (!token) {
                event.preventDefault();
                alert('This endpoint requires authentication. Please login first!');
                window.location.href = '/login';
            }
        }
        
        function showLogs() {
            window.location.href = '/logs';
        }
        
        function logout() {
            document.cookie = 'auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            window.location.reload();
        }
        
        // Check auth status on page load
        checkAuthStatus();
        
        // Auto-update temperature every 10 seconds
        setInterval(updateTemperature, 10000);
        updateTemperature();
        
        // Check API status
        fetch('/api/status')
            .then(response => response.json())
            .then(data => {
                console.log('API Status:', data);
            });
    </script>
</body>
</html>